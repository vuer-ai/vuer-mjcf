from vuer_mjcf.schema import FreeBody


class Poncho(FreeBody):
    """
    Static humanoid mannequin model with all joints removed.
    Based on the DeepMind mannequin model.
    """
    _attributes = {"name": "torso"}

    _preamble = """
    <default>
      <default class="body">
        <!-- geoms -->
        <geom type="capsule" condim="1" friction=".7" solimp=".9 .99 .003" solref=".003 1" material="body"/>
        <default class="thigh">
          <geom size=".06"/>
        </default>
        <default class="shin">
          <geom fromto="0 0 0 0 0 -.3"  size=".049"/>
        </default>
        <default class="foot">
          <geom size=".027"/>
          <default class="foot1">
            <geom fromto="-.07 -.01 0 .14 -.03 0"/>
          </default>
          <default class="foot2">
            <geom fromto="-.07 .01 0 .14  .03 0"/>
          </default>
        </default>
        <default class="arm_upper">
          <geom size=".04"/>
        </default>
        <default class="arm_lower">
          <geom size=".031"/>
        </default>
        <default class="hand">
          <geom type="sphere" size=".04"/>
        </default>
      </default>
    </default>

    <asset>
      <texture name="body" type="cube" builtin="flat" mark="cross" width="128" height="128" rgb1="0.8 0.6 0.4" rgb2="0.8 0.6 0.4" markrgb="1 1 1" random="0.01"/>
      <material name="body" texture="body" texuniform="true" rgba="0.8 0.6 .4 1"/>
    </asset>

    <contact>
      <exclude body1="waist_lower" body2="thigh_right"/>
      <exclude body1="waist_lower" body2="thigh_left"/>
    </contact>
    """

    def __init__(self, name="mannequin", pos=None, quat=None, **kwargs):
        # Set default position if not provided
        if pos is None:
            pos = [0, 0, 1.282]

        super().__init__(pos=pos, quat=quat, **kwargs)

        # Override the name attribute
        self._attributes["name"] = "torso"
        self._attributes["childclass"] = "body"

        self._children_raw = """
        <geom name="torso" fromto="0 -.07 0 0 .07 0" size=".07"/>
        <geom name="waist_upper" fromto="-.01 -.06 -.12 -.01 .06 -.12" size=".06"/>

        <body name="head" pos="0 0 .19">
          <geom name="head" type="sphere" size=".09"/>
        </body>

        <body name="neck">
          <geom type="cylinder" size=".03" fromto="0 0 .07 0 0 .1"/>
        </body>

        <body name="waist_lower" pos="-.01 0 -.26">
          <geom name="waist_lower" fromto="0 -.06 0 0 .06 0" size=".06"/>

          <body name="pelvis" pos="0 0 -.165">
            <geom name="butt" fromto="-.02 -.07 0 -.02 .07 0" size=".09"/>

            <body name="thigh_right" pos="0 -.1 -.04">
              <geom name="thigh_right" fromto="0 0 0 0 .01 -.34" class="thigh"/>
              <body name="shin_right" pos="0 .01 -.4">
                <geom name="shin_right" class="shin"/>
                <body name="foot_right" pos="0 0 -.39">
                  <geom name="foot1_right" class="foot1"/>
                  <geom name="foot2_right" class="foot2"/>
                </body>
              </body>
            </body>

            <body name="thigh_left" pos="0 .1 -.04">
              <geom name="thigh_left" fromto="0 0 0 0 -.01 -.34" class="thigh"/>
              <body name="shin_left" pos="0 -.01 -.4">
                <geom name="shin_left" fromto="0 0 0 0 0 -.3" class="shin"/>
                <body name="foot_left" pos="0 0 -.39">
                  <geom name="foot1_left" class="foot1"/>
                  <geom name="foot2_left" class="foot2"/>
                </body>
              </body>
            </body>
          </body>
        </body>

        <body name="upper_arm_right" pos="0 -.17 .06">
          <geom name="upper_arm_right" fromto="0 0 0 0 -.22 0" class="arm_upper"/>
          <body name="lower_arm_right" pos="0 -.22 0">
            <geom name="lower_arm_right" fromto=".01 .01 .01 0 -.21 -.05" class="arm_lower"/>
            <body name="hand_right" pos="0 -.22 -.05">
              <geom name="hand_right" zaxis="1 1 1" class="hand"/>
            </body>
          </body>
        </body>

        <body name="upper_arm_left" pos="0 .17 .06">
          <geom name="upper_arm_left" fromto="0 0 0 0 .22 0" class="arm_upper"/>
          <body name="lower_arm_left" pos="0 .22 0">
            <geom name="lower_arm_left" fromto=".01 -.01 .01 0 .21 -.05" class="arm_lower"/>
            <body name="hand_left" pos="0 .22 -.05">
              <geom name="hand_left" zaxis="1 -1 1" class="hand"/>
            </body>
          </body>
        </body>
        """
